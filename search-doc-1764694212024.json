{"searchDocs":[{"title":"üëê RUN : Network Challenge","type":0,"sectionRef":"#","url":"/security-basics-lab/docs/challenge/network","content":"","keywords":"","version":"Next"},{"title":"1. Add \"My current IP\" temporary into the atlas project‚Äã","type":1,"pageTitle":"üëê RUN : Network Challenge","url":"/security-basics-lab/docs/challenge/network#1-add-my-current-ip-temporary-into-the-atlas-project","content":" from datetime import datetime, timedelta from zoneinfo import ZoneInfo # Calculate the date and time 24 hours from now delete_after = (datetime.now(ZoneInfo('UTC')) + timedelta(hours=24)).isoformat() !atlas accessLists &lt;CODE_BLOCK&gt;   tip Docs : atlas accessList   Answer from datetime import datetime, timedelta from zoneinfo import ZoneInfo # Calculate the date and time 24 hours from now delete_after = (datetime.now(ZoneInfo('UTC')) + timedelta(hours=24)).isoformat() !atlas accessLists create --currentIp --projectId {project_id} --deleteAfter {delete_after}   info The IP added is the &quot;local&quot; IP for the environment running the notebook. If you're running this in Collab / Codespaces this local IP will not be your computer's local IP.  ","version":"Next","tagName":"h3"},{"title":"2. Check that \"My current IP\" was added‚Äã","type":1,"pageTitle":"üëê RUN : Network Challenge","url":"/security-basics-lab/docs/challenge/network#2-check-that-my-current-ip-was-added","content":" !atlas accessLists list --output json --projectId {project_id}   You should get a JSON document that contains information in the results array.  ","version":"Next","tagName":"h3"},{"title":"Next steps‚Äã","type":1,"pageTitle":"üëê RUN : Network Challenge","url":"/security-basics-lab/docs/challenge/network#next-steps","content":" Start the chapter on authentication for database user management. ","version":"Next","tagName":"h2"},{"title":"üìò MongoDB Security Configuration","type":0,"sectionRef":"#","url":"/security-basics-lab/docs/atlas","content":"","keywords":"","version":"Next"},{"title":"Network security‚Äã","type":1,"pageTitle":"üìò MongoDB Security Configuration","url":"/security-basics-lab/docs/atlas#network-security","content":" MongoDB AtlasOn-Premises IP access list‚Äã Control which IP addresses can connect to your cluster: // Using Atlas CLI atlas accessLists create --currentIp atlas accessLists create --ip &quot;203.0.113.0/24&quot; Importance: Restricting access to known IP addresses prevents unauthorized connections and reduces the risk of external attacks. Private endpoints‚Äã Set up AWS PrivateLink: // Create private endpoint atlas privateEndpoints aws create --region us-east-1 --projectId 5e2211c17a3e5a48f5497de3 --output json Importance: Private endpoints ensure that traffic between your application and MongoDB Atlas remains within your private network, enhancing security and reducing exposure to the public internet. Network peering‚Äã // Set up VPC peering atlas networking peering create aws --accountId 854333054055 --atlasCidrBlock 192.168.0.0/24 --region us-east-1 --routeTableCidrBlock 10.0.0.0/24 --vpcId vpc-078ac381aa90e1e63 Importance: Network peering allows you to connect your VPC to MongoDB Atlas's VPC, providing a secure and private connection without traversing the public internet.  ","version":"Next","tagName":"h2"},{"title":"Encryption configuration‚Äã","type":1,"pageTitle":"üìò MongoDB Security Configuration","url":"/security-basics-lab/docs/atlas#encryption-configuration","content":" MongoDB AtlasOn-Premises Encryption at rest‚Äã Atlas automatically encrypts all data using: AWS: AWS KMS.Azure: Azure Key Vault.GCP: Cloud KMS. Importance: Encryption at rest protects your data from unauthorized access if the storage media is compromised.  ","version":"Next","tagName":"h2"},{"title":"Best practices‚Äã","type":1,"pageTitle":"üìò MongoDB Security Configuration","url":"/security-basics-lab/docs/atlas#best-practices","content":" MongoDB AtlasOn-Premises Network security Use private endpoints where possibleRegularly review IP access listsImplement VPC peering Access management Follow principle of least privilegeRegular credential rotationUse strong authentication methods Monitoring and alerts Set up alerts for security eventsMonitor access patternsReview audit logs regularly  ","version":"Next","tagName":"h2"},{"title":"Next steps‚Äã","type":1,"pageTitle":"üìò MongoDB Security Configuration","url":"/security-basics-lab/docs/atlas#next-steps","content":" Let's start the network access control challenge. ","version":"Next","tagName":"h2"},{"title":"Authentication in MongoDB","type":0,"sectionRef":"#","url":"/security-basics-lab/docs/authentication","content":"","keywords":"","version":"Next"},{"title":"Authentication Mechanisms‚Äã","type":1,"pageTitle":"Authentication in MongoDB","url":"/security-basics-lab/docs/authentication#authentication-mechanisms","content":" MongoDB AtlasOn-Premises Atlas User Types In MongoDB Atlas, there are two main types of users: Atlas Control Plane Users: These users manage the Atlas infrastructure, projects, and services (e.g., creating clusters, configuring network access, managing billing). They interact with the Atlas UI, API, or CLI.Atlas Data Plane Users: These users are created within an Atlas project and are used by applications and clients to connect to and authenticate against the actual MongoDB databases hosted on Atlas. They have specific database roles and privileges. MongoDB Atlas supports multiple authentication mechanisms: SCRAM (Default): The default and simplest mechanism for MongoDB, providing secure authentication using salted challenge-response methods. (For production deployment we recommend using a more advanced authentication mechanism)X.509 Certificate Authentication: Certificate-based authentication that uses SSL/TLS certificates for verifying client identity, typically used in environments that require high security.AWS IAM Authentication:MongoDB Atlas supports AWS IAM authentication, allowing users to authenticate using their AWS Identity and Access Management roles, which is useful for integration with AWS services.Workforce Identity Federation Authentication: Allows users to integrate MongoDB Atlas with external identity providers (IdPs) like Okta or Azure AD for centralized access management and single sign-on (SSO).Workload Identity Federation Authentication: Enables authentication for applications and workloads by allowing them to assume predefined roles, simplifying access management for services running in hybrid or multi-cloud environments.LDAP Authentication: Allows integration with corporate directory services, enabling centralized management of user access across the organization. SCRAM Authentication‚Äã SCRAM (Salted Challenge Response Authentication Mechanism) is MongoDB's default authentication mechanism. It provides secure username/password authentication. Creating a User with SCRAM Authentication‚Äã // In MongoDB Atlas UI: Database Access &gt; Add New Database User // Or using Atlas CLI: atlas dbusers create --username demoUser --password mySecurePassword --role readWriteAnyDatabase --projectId Database user 'demoUser' successfully created. Atlas Administration API //Use Atlas Admin API POST /api/atlas/v1.0/groups/{GROUP-ID}/databaseUsers { &quot;databaseName&quot;: &quot;admin&quot;, &quot;username&quot;: &quot;demoUser&quot;, &quot;password&quot;: &quot;secure_password&quot;, &quot;roles&quot;: [{ &quot;roleName&quot;: &quot;readWrite&quot;, &quot;databaseName&quot;: &quot;myDatabase&quot; }] } Connecting with SCRAM Authentication‚Äã mongosh &quot;mongodb+srv://cluster0.example.mongodb.net/myDatabase&quot; \\ --username demoUser \\ --password mySecurePassword AWS IAM Authentication‚Äã Atlas clusters on AWS can use IAM authentication: Configure IAM Authentication in Atlas UICreate an IAM Role with necessary permissionsConnect using AWS credentials: mongosh &quot;mongodb+srv://&lt;atlas-host-name&gt;/test?authSource=%24external&amp;authMechanism=MONGODB-AWS&quot; --username &lt;access-key-id&gt; --password &lt;secret-key&gt; X.509 Certificate Authentication‚Äã Certificate-based authentication that uses SSL/TLS certificates for verifying client identity, typically used in environments that require high security. ## Create User !atlas dbusers create --username demoX509User --x509Type MANAGED --role readAnyDatabase --projectId {project_id} ## Create the relevant certificate !atlas dbusers certs create --username demoX509User --monthsUntilExpiration 1 --projectId {project_id} &gt; /tmp/cert.pem Connect using X509 via shell mongosh &quot;mongodb+srv://&lt;atlas-host-name&gt;/test?authSource=%24external&amp;authMechanism=MONGODB-X509&quot; --tlsCertificateKeyFile /tmp/cert.pem   ","version":"Next","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Authentication in MongoDB","url":"/security-basics-lab/docs/authentication#best-practices","content":" MongoDB AtlasOn-Premises User Management Use Database Access page in Atlas UI for user managementImplement role-based access control (RBAC)Regularly audit user access and permissions Connection Security Use connection strings with mongodb+srv:// protocolEnable Network Access List restrictionsImplement IP access lists Authentication Methods Use AWS IAM authentication when possible for AWS deploymentsImplement strong password policiesConsider X.509 for application authentication  ","version":"Next","tagName":"h2"},{"title":"Challenges and Exercises‚Äã","type":1,"pageTitle":"Authentication in MongoDB","url":"/security-basics-lab/docs/authentication#challenges-and-exercises","content":" Let's move to the Authentication challenge.  ","version":"Next","tagName":"h2"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Authentication in MongoDB","url":"/security-basics-lab/docs/authentication#next-steps","content":" After mastering authentication, proceed to learn about Role-Based Access Control (RBAC) to implement fine-grained access control for your MongoDB deployment. ","version":"Next","tagName":"h2"},{"title":"üëê RUN: Authentication Challenge","type":0,"sectionRef":"#","url":"/security-basics-lab/docs/challenge/authentication","content":"","keywords":"","version":"Next"},{"title":"1. Create a SCRAM user‚Äã","type":1,"pageTitle":"üëê RUN: Authentication Challenge","url":"/security-basics-lab/docs/challenge/authentication#1-create-a-scram-user","content":" # create a SCRAM user with username: &quot;myUser&quot;, password: &quot;mySecurePassword&quot; and role: &quot;readWriteAnyDatabase&quot; username = &quot;myUser&quot; password = &quot;mySecurePassword&quot; !atlas dbusers create &lt;CODE_BLOCK&gt;   Refer to documentation: atlas dbusers  tip Answer # create a SCRAM user with username: &quot;myUser&quot;, password: &quot;mySecurePassword&quot; and role: &quot;readWriteAnyDatabase&quot; username = &quot;myUser&quot; password = &quot;mySecurePassword&quot; !atlas dbusers create --username {username} --password {password} --role readWriteAnyDatabase --projectId {project_id}   ","version":"Next","tagName":"h3"},{"title":"2. Let's test our SCRAM user successful creation by performing the authentication process‚Äã","type":1,"pageTitle":"üëê RUN: Authentication Challenge","url":"/security-basics-lab/docs/challenge/authentication#2-lets-test-our-scram-user-successful-creation-by-performing-the-authentication-process","content":" !pip install pymongo dnspython   # retrieve connection string connection = !atlas clusters connectionStrings describe MyNewCluster --projectId {project_id} # add username and password to connection string new_connection = connection[1].replace('mongodb+srv://', f'mongodb+srv://{username}:{password}@') print(new_connection) #make the connection get the list of databases from pymongo import MongoClient client = MongoClient(new_connection) client.list_database_names()   ","version":"Next","tagName":"h3"},{"title":"3. Create a X509 user and certificate‚Äã","type":1,"pageTitle":"üëê RUN: Authentication Challenge","url":"/security-basics-lab/docs/challenge/authentication#3-create-a-x509-user-and-certificate","content":" # create a Atlas-managed X509 user with username: &quot;myX509User&quot; and role: &quot;readAnyDatabase&quot; !atlas dbusers create &lt;CODE_BLOCK&gt;   Refer to documentation: atlas dbusers  # Generate a certification for &quot;myX509user&quot;, set monthsUntilExpiration to 1, and save it to /tmp/cert.pem !atlas dbusers certs create &lt;CODE_BLOCK&gt; &gt; /tmp/cert.pem   Refer to documentation: atlas dbusers certs  tip Answer # create a Atlas-managed X509 user with username: &quot;myX509User&quot; and role: &quot;readAnyDatabase&quot; !atlas dbusers create --username myX509User --role readAnyDatabase --x509Type MANAGED --projectId {project_id} # Generate a certification for &quot;myX509user&quot;, set monthsUntilExpiration to 1, and save it to /tmp/cert.pem !atlas dbusers certs create --username myX509User --monthsUntilExpiration 1 --projectId {project_id} &gt; /tmp/cert.pem   ","version":"Next","tagName":"h3"},{"title":"4. Let's test our X509 user‚Äã","type":1,"pageTitle":"üëê RUN: Authentication Challenge","url":"/security-basics-lab/docs/challenge/authentication#4-lets-test-our-x509-user","content":" # Get connection string connection = !atlas clusters connectionStrings describe MyNewCluster --projectId {project_id} # Modify connection string to use X509 as authentication mechanism new_connection = connection[1].replace('.net', '.net?authSource=%24external&amp;authMechanism=MONGODB-X509') print(new_connection) # Connect using the certificate from pymongo import MongoClient client = MongoClient(new_connection, tlsCertificateKeyFile='/tmp/cert.pem') # Access the database client.list_database_names()   ","version":"Next","tagName":"h3"},{"title":"Next steps‚Äã","type":1,"pageTitle":"üëê RUN: Authentication Challenge","url":"/security-basics-lab/docs/challenge/authentication#next-steps","content":" Start the chapter on RBAC for role-based access user management. ","version":"Next","tagName":"h2"},{"title":"üëê RUN : RBAC Challenge","type":0,"sectionRef":"#","url":"/security-basics-lab/docs/challenge/rbac","content":"","keywords":"","version":"Next"},{"title":"1. Create a user for \"MyNewCluster\" database with role-based access.‚Äã","type":1,"pageTitle":"üëê RUN : RBAC Challenge","url":"/security-basics-lab/docs/challenge/rbac#1-create-a-user-for-mynewcluster-database-with-role-based-access","content":" Create a new user with the built-in role readWriteAnyDatabase and the username and password below.  The user access should be scoped to the myNewCluster cluster. Use the --scope option.  Refer to the documentation: https://www.mongodb.com/docs/atlas/cli/current/command/atlas-dbusers-create/.  # Create a user:'myNewClusterAdmin', password:'myNewClusterAdminPass', role: 'readWriteAnyDatabase' # and scoped to &quot;MyNewCluster&quot; database newClusterAdminUser = 'myNewClusterAdmin' newClusterAdminPass = 'myNewClusterAdminPass' !atlas dbusers create &lt;CODE_BLOCK&gt;   tip Answer # Create a user:'myNewClusterAdmin', password:'myNewClusterAdminPass', role: 'readWriteAnyDatabase' # and scoped to &quot;MyNewCluster&quot; database newClusterAdminUser = 'myNewClusterAdmin' newClusterAdminPass = 'myNewClusterAdminPass' !atlas dbusers create --username {newClusterAdminUser} --password {newClusterAdminPass} --role readWriteAnyDatabase --scope 'MyNewCluster' --projectId {project_id}   ","version":"Next","tagName":"h3"},{"title":"2. Create a user with read-only access to the \"salesDB\" database.‚Äã","type":1,"pageTitle":"üëê RUN : RBAC Challenge","url":"/security-basics-lab/docs/challenge/rbac#2-create-a-user-with-read-only-access-to-the-salesdb-database","content":" Create a custom role named salesRead with read-only access to the salesDB database.  Refer to the documentation: atlas customDbRoles.  #Create a role &quot;salesRead&quot; which access to read-only role to salesDB database !atlas customDbRoles create &lt;CODE_BLOCK&gt;   tip Answer #Create a role &quot;salesRead&quot; which access to read-only role to salesDB database !atlas customDbRoles create salesRead --inheritedRole read@salesDB --projectId {project_id}   Now, we will create a user salesReadUser with password salesReadPass which has the salesRead role.  salesReadUser = 'salesReadUser' salesReadPass = 'salesReadPass' !atlas dbusers create &lt;CODE_BLOCK&gt;   tip Answer #Create a user &quot;salesReadUser&quot; with password &quot;salesReadPass&quot; which has the &quot;salesRead&quot; role salesReadUser = 'salesReadUser' salesReadPass = 'salesReadPass' !atlas dbusers create --username salesReadUser --password salesReadPass --role salesRead --projectId {project_id}   ","version":"Next","tagName":"h3"},{"title":"3. Test that \"salesReadUser\" cannot insert data into the \"salesDB\" database.‚Äã","type":1,"pageTitle":"üëê RUN : RBAC Challenge","url":"/security-basics-lab/docs/challenge/rbac#3-test-that-salesreaduser-cannot-insert-data-into-the-salesdb-database","content":" We will test that indeed salesReadUser can't write to the database.  # Get connection string connection = !atlas clusters connectionStrings describe MyNewCluster --projectId {project_id} # Replace connection string with username and password new_connection = connection[1].replace('mongodb+srv://', f'mongodb+srv://{salesReadUser}:{salesReadPass}@') # Attempt to insert data client = MongoClient(new_connection) db = client['salesDB'] collection = db['mycollection'] try: data = {'name': 'John Doe', 'age': 30} result = collection.insert_one(data) print(f&quot;Inserted document with ID: {result.inserted_id}&quot;) except Exception as e: print(f&quot;Error inserting data: {e}&quot;)   ","version":"Next","tagName":"h3"},{"title":"4. Test that \"myNewClusterAdmin\" can insert data into the \"salesDB\" database.‚Äã","type":1,"pageTitle":"üëê RUN : RBAC Challenge","url":"/security-basics-lab/docs/challenge/rbac#4-test-that-mynewclusteradmin-can-insert-data-into-the-salesdb-database","content":" # Get connection string connection = !atlas clusters connectionStrings describe MyNewCluster --projectId {project_id} # Replace connection string with username and password new_connection = connection[1].replace('mongodb+srv://', f'mongodb+srv://{newClusterAdminUser}:{newClusterAdminPass}@') # Attempt to insert data client = MongoClient(new_connection) db = client['salesDB'] collection = db['mycollection'] try: data = {'name': 'John Doe', 'age': 30} result = collection.insert_one(data) print(f&quot;Inserted document with ID: {result.inserted_id}&quot;) except Exception as e: print(f&quot;Error inserting data: {e}&quot;)   ","version":"Next","tagName":"h3"},{"title":"Next steps‚Äã","type":1,"pageTitle":"üëê RUN : RBAC Challenge","url":"/security-basics-lab/docs/challenge/rbac#next-steps","content":" Start the chapter on queryable encryption for data encryption. ","version":"Next","tagName":"h2"},{"title":"üëê RUN: Queryable Encryption challenge","type":0,"sectionRef":"#","url":"/security-basics-lab/docs/challenge/queryable-encryption","content":"","keywords":"","version":"Next"},{"title":"1. Install the necessary packages.‚Äã","type":1,"pageTitle":"üëê RUN: Queryable Encryption challenge","url":"/security-basics-lab/docs/challenge/queryable-encryption#1-install-the-necessary-packages","content":" !pip install pymongo[encryption] !pip install pymongo !pip install requests   ","version":"Next","tagName":"h3"},{"title":"2. Set up the crypt_shared library.‚Äã","type":1,"pageTitle":"üëê RUN: Queryable Encryption challenge","url":"/security-basics-lab/docs/challenge/queryable-encryption#2-set-up-the-crypt_shared-library","content":" import os from pymongo import MongoClient from pymongo.encryption import Algorithm, ClientEncryption, QueryType from pymongo.encryption_options import AutoEncryptionOpts from bson.codec_options import CodecOptions from bson import json_util import json import requests import platform import tempfile def setup_crypt_shared(): system = platform.system().lower() if system == &quot;linux&quot;: url = &quot;https://downloads.mongodb.com/linux/mongo_crypt_shared_v1-linux-x86_64-enterprise-ubuntu2004-6.0.6.tgz&quot; filename = &quot;mongo_crypt_shared_v1-linux-x86_64-enterprise-ubuntu2004-6.0.6.tgz&quot; elif system == &quot;darwin&quot;: url = &quot;https://downloads.mongodb.com/osx/mongo_crypt_shared_v1-macos-x86_64-enterprise-6.0.6.tgz&quot; filename = &quot;mongo_crypt_shared_v1-macos-x86_64-enterprise-6.0.6.tgz&quot; elif system == &quot;windows&quot;: url = &quot;https://downloads.mongodb.com/windows/mongo_crypt_shared_v1-windows-x86_64-enterprise-6.0.6.zip&quot; filename = &quot;mongo_crypt_shared_v1-windows-x86_64-enterprise-6.0.6.zip&quot; else: raise OSError(&quot;Unsupported operating system&quot;) response = requests.get(url) response.raise_for_status() with tempfile.NamedTemporaryFile(delete=False, suffix=&quot;.tgz&quot; if system != &quot;windows&quot; else &quot;.zip&quot;) as tmp_file: tmp_file.write(response.content) tmp_file_path = tmp_file.name extract_dir = tempfile.mkdtemp() if system != &quot;windows&quot;: os.system(f&quot;tar -xzf {tmp_file_path} -C {extract_dir}&quot;) lib_path = os.path.join(extract_dir, &quot;lib&quot;, &quot;mongo_crypt_v1.so&quot;) else: os.system(f&quot;powershell Expand-Archive -Path {tmp_file_path} -DestinationPath {extract_dir}&quot;) lib_path = os.path.join(extract_dir, &quot;bin&quot;, &quot;mongo_crypt_v1.dll&quot;) return lib_path crypt_shared_lib_path = setup_crypt_shared() print(f&quot;Crypt shared library path: {crypt_shared_lib_path}&quot;)   ","version":"Next","tagName":"h3"},{"title":"3. Connect to your Atlas cluster.‚Äã","type":1,"pageTitle":"üëê RUN: Queryable Encryption challenge","url":"/security-basics-lab/docs/challenge/queryable-encryption#3-connect-to-your-atlas-cluster","content":" connection = !atlas clusters connectionStrings describe MyNewCluster --projectId {project_id} new_connection = connection[1].replace('mongodb+srv://', f'mongodb+srv://{username}:{password}@') print(new_connection) from pymongo import MongoClient client = MongoClient(new_connection)   ","version":"Next","tagName":"h3"},{"title":"4. Set up an encrypted client using a local KMS provider.‚Äã","type":1,"pageTitle":"üëê RUN: Queryable Encryption challenge","url":"/security-basics-lab/docs/challenge/queryable-encryption#4-set-up-an-encrypted-client-using-a-local-kms-provider","content":" # generate a random 96 byte key local_master_key = os.urandom(96) # configure encryption options kms_providers = {&quot;local&quot;: {&quot;key&quot;: local_master_key}} key_vault_namespace = &quot;encryption.__keyVault&quot; key_vault_database_name = &quot;encryption&quot; key_vault_collection_name = &quot;__keyVault&quot; key_vault_namespace = f&quot;{key_vault_database_name}.{key_vault_collection_name}&quot; auto_encryption_options = AutoEncryptionOpts( kms_providers, key_vault_namespace, crypt_shared_lib_path=crypt_shared_lib_path ) # set up client and encryption encrypted_client = MongoClient( new_connection, auto_encryption_opts=auto_encryption_options) client_encryption = ClientEncryption( kms_providers=kms_providers, key_vault_namespace=key_vault_namespace, key_vault_client=encrypted_client, codec_options=CodecOptions() )   ","version":"Next","tagName":"h3"},{"title":"5. Consider the following sample \"patient\" document.‚Äã","type":1,"pageTitle":"üëê RUN: Queryable Encryption challenge","url":"/security-basics-lab/docs/challenge/queryable-encryption#5-consider-the-following-sample-patient-document","content":" patient_document = { &quot;patientName&quot;: &quot;Jon Doe&quot;, &quot;patientId&quot;: 12345678, &quot;patientRecord&quot;: { &quot;ssn&quot;: &quot;987-65-4320&quot;, &quot;billing&quot;: { &quot;type&quot;: &quot;Visa&quot;, &quot;number&quot;: &quot;4111111111111111&quot;, }, }, }   ","version":"Next","tagName":"h3"},{"title":"6. Create an encrypted collection based on the following requirements.‚Äã","type":1,"pageTitle":"üëê RUN: Queryable Encryption challenge","url":"/security-basics-lab/docs/challenge/queryable-encryption#6-create-an-encrypted-collection-based-on-the-following-requirements","content":" 'patientId' and 'billing' must be encryptedpatients will be queried by 'patientId'  # Create encrypted fields map encrypted_fields_map = &lt;CODE_BLOCK&gt; encrypted_database_name = 'medicalRecords' encrypted_collection_name = 'patients' kms_provider_name = 'local' client_encryption.create_encrypted_collection( encrypted_client[encrypted_database_name], encrypted_collection_name, encrypted_fields_map, kms_provider_name, {}, )    Answer # Create encrypted fields map encrypted_fields_map = { 'fields': [ { 'path': 'patientRecord.ssn', 'bsonType': 'string', 'queries': [{'queryType': 'equality'}] }, { 'path': 'patientRecord.billing', 'bsonType': 'object' } ] } encrypted_database_name = 'medicalRecords' encrypted_collection_name = 'patients' kms_provider_name = 'local' client_encryption.create_encrypted_collection( encrypted_client[encrypted_database_name], encrypted_collection_name, encrypted_fields_map, kms_provider_name, {}, )   ","version":"Next","tagName":"h3"},{"title":"7. Insert the sample \"patient\" document.‚Äã","type":1,"pageTitle":"üëê RUN: Queryable Encryption challenge","url":"/security-basics-lab/docs/challenge/queryable-encryption#7-insert-the-sample-patient-document","content":" encrypted_collection = encrypted_client[encrypted_database_name][encrypted_collection_name] result = &lt;CODE_BLOCK&gt; print(f&quot;Inserted document ID: {result.inserted_id}&quot;)   tip Answer encrypted_collection = encrypted_client[encrypted_database_name][encrypted_collection_name] result = encrypted_collection.insert_one(patient_document) print(f&quot;Inserted document ID: {result.inserted_id}&quot;)   ","version":"Next","tagName":"h3"},{"title":"8. Find the patient by its \"ssn.\"‚Äã","type":1,"pageTitle":"üëê RUN: Queryable Encryption challenge","url":"/security-basics-lab/docs/challenge/queryable-encryption#8-find-the-patient-by-its-ssn","content":" find_result = &lt;CODE_BLOCK&gt; print(find_result)   You should be able to successfully retrieve the patient.  tip Answer find_result = encrypted_collection.find_one({ &quot;patientRecord.ssn&quot;: &quot;987-65-4320&quot; }) print(find_result)   ","version":"Next","tagName":"h3"},{"title":"9. Make the same query the collection without encryption/decryption.‚Äã","type":1,"pageTitle":"üëê RUN: Queryable Encryption challenge","url":"/security-basics-lab/docs/challenge/queryable-encryption#9-make-the-same-query-the-collection-without-encryptiondecryption","content":" reg_mongoclient = MongoClient(new_connection) reg_collection = reg_mongoclient[encrypted_database_name][encrypted_collection_name] find_result = &lt;CODE_BLOCK&gt; print(find_result)   You should not be able to find a record since the &quot;ssn&quot; in the document is encrypted.  tip Answer reg_mongoclient = MongoClient(new_connection) reg_collection = reg_mongoclient[encrypted_database_name][encrypted_collection_name] find_result = reg_collection.find_one({ &quot;patientRecord.ssn&quot;: &quot;987-65-4320&quot; }) print(find_result)   ","version":"Next","tagName":"h3"},{"title":"10. Read all documents in the collection without encryption/decryption.‚Äã","type":1,"pageTitle":"üëê RUN: Queryable Encryption challenge","url":"/security-basics-lab/docs/challenge/queryable-encryption#10-read-all-documents-in-the-collection-without-encryptiondecryption","content":" all_docs = reg_mongoclient[encrypted_database_name][encrypted_collection_name].find() print(&quot;\\nAll documents in the collection:&quot;) for doc in all_docs: print(doc)   You will be able to retrieve the documents, but encrypted data stays encrypted.  ","version":"Next","tagName":"h3"},{"title":"Next steps‚Äã","type":1,"pageTitle":"üëê RUN: Queryable Encryption challenge","url":"/security-basics-lab/docs/challenge/queryable-encryption#next-steps","content":" Go to &quot;Security Considerations and Summary&quot; for self-managed deployments and a recap of this workshop. ","version":"Next","tagName":"h2"},{"title":"MongoDB Security Basics","type":0,"sectionRef":"#","url":"/security-basics-lab/docs/intro","content":"","keywords":"","version":"Next"},{"title":"Overview‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#overview","content":" This guide is structured to help you understand and implement MongoDB security features effectively. Each section provides side-by-side comparisons of implementing security features in both MongoDB Atlas and On-premises environments.  In the navigation bar and in some pages, you will notice some icons. Here are their meanings:  Icon\tMeaning\tDescriptionüìò\tLecture material\tIf you are following along in an instructor-led session, they probably have covered this already. üëê\tHands-on content\tGet ready to do some hands-on work. You should follow these steps. üìö\tDocumentation\tReference documentation for hands-on portions of the lab. ü¶π\tAdvanced content\tThis content isn't covered during the lab, but if you're interested in learning more, you can check it out.  ","version":"Next","tagName":"h2"},{"title":"Topics covered‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#topics-covered","content":" ","version":"Next","tagName":"h2"},{"title":"1. Intro and network security‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#1-intro-and-network-security","content":" Explore Atlas-specific security features:  Network access controlsPrivate endpoints  Explore self-hosted considerations for network security.  ","version":"Next","tagName":"h3"},{"title":"2. Authentication‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#2-authentication","content":" Learn about different authentication mechanisms and how to:  Set up user authentication.Implement X.509 certificate authentication.Manage credentials securely.  ","version":"Next","tagName":"h3"},{"title":"3. Role-based access control (RBAC)‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#3-role-based-access-control-rbac","content":" Understand how to:  Create and manage roles.Assign privileges to roles.Implement role inheritance.Follow security best practices for access control.  ","version":"Next","tagName":"h3"},{"title":"4. Queryable encryption‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#4-queryable-encryption","content":" Learn how to handle your sensitive information with our most advanced encryption technique:  Set up encryption keys.Create an encrypted client.Write and read encrypted field data.  ","version":"Next","tagName":"h3"},{"title":"5. Security considerations and summary‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#5-security-considerations-and-summary","content":" Learn about additional Atlas and self-hosted security configurations:  System hardeningEncryption optionsDatabase auditingBackup securityAudit loggingBackup strategies  ","version":"Next","tagName":"h3"},{"title":"Getting started‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#getting-started","content":" ","version":"Next","tagName":"h2"},{"title":"Prerequisites‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#prerequisites","content":" Before implementing security measures, ensure you have:  MongoDB Atlas users An Atlas accountAccess to a notebook environment to install Atlas CLI on. Recommended one of: Google colab, for general concepts: Get yourself familiar with Jupyter Notebooks.Github CodespacesVS Code On-premises users MongoDB installedAdministrative accessBasic understanding of Linux/Unix systems  ","version":"Next","tagName":"h3"},{"title":"Using this guide‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#using-this-guide","content":" Each section provides:  Side-by-side comparisons of Atlas and On-premises implementations.Practical code examples.Best practices.Security checklists.Hands-on exercises by using .ipynb notebooks.  ","version":"Next","tagName":"h2"},{"title":"Tab navigation‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#tab-navigation","content":" Throughout this guide, you'll find content organized in tabs:  Atlas: MongoDB Atlas-specific instructionsOn-premises: Self-hosted deployment instructions  This allows you to focus on the content relevant to your deployment type while understanding the differences between approaches.  ","version":"Next","tagName":"h3"},{"title":"Security best practices‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#security-best-practices","content":" Regardless of your deployment type, always:  Network security Restrict network access.Use TLS/SSL encryption.Implement proper firewall rules. Enable authentication Never run MongoDB without authentication.Use strong passwords.Implement appropriate authentication mechanisms. Use access controls Follow the principle of least privilege.Regularly audit user access.Implement role-based access control. Use queryable encryption Set up queryable encryption.Create database encrypted client and collections.Read and write encrypted documents.  ","version":"Next","tagName":"h2"},{"title":"Next steps‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#next-steps","content":" Start with Initial Setup to get started on completing the challenge sections.Progress to Network Setup for authorising access and Authentication for database user management and Authorization.Explore queryable encryption for document-based security.Finally, recap everything in Security Considerations and Summary.  ","version":"Next","tagName":"h2"},{"title":"Additional resources‚Äã","type":1,"pageTitle":"MongoDB Security Basics","url":"/security-basics-lab/docs/intro#additional-resources","content":" MongoDB security documentationMongoDB Atlas documentationSecurity checklist  Remember to regularly review and update your security configurations to maintain the safety of your MongoDB deployments. ","version":"Next","tagName":"h2"},{"title":"Security Considerations","type":0,"sectionRef":"#","url":"/security-basics-lab/docs/considerations","content":"","keywords":"","version":"Next"},{"title":"Learning path‚Äã","type":1,"pageTitle":"Security Considerations","url":"/security-basics-lab/docs/considerations#learning-path","content":" Foundation: Understanding basic security principlesImplementation: Hands-on configuration and setupAdvanced features: Exploring sophisticated security measuresCompliance: Meeting industry standardsMaintenance: Ongoing security management  ","version":"Next","tagName":"h2"},{"title":"Security foundation‚Äã","type":1,"pageTitle":"Security Considerations","url":"/security-basics-lab/docs/considerations#security-foundation","content":" ","version":"Next","tagName":"h2"},{"title":"Key security concepts‚Äã","type":1,"pageTitle":"Security Considerations","url":"/security-basics-lab/docs/considerations#key-security-concepts","content":" Authentication and authorizationEncryption (At-rest/data at-rest and in-transit)Audit loggingNetwork securityBackup and recovery  ","version":"Next","tagName":"h3"},{"title":"Security architecture overview‚Äã","type":1,"pageTitle":"Security Considerations","url":"/security-basics-lab/docs/considerations#security-architecture-overview","content":"   ","version":"Next","tagName":"h3"},{"title":"Security implementation roadmap‚Äã","type":1,"pageTitle":"Security Considerations","url":"/security-basics-lab/docs/considerations#security-implementation-roadmap","content":" Phase 1: Basic security setup Authentication setupNetwork securityBasic encryption Phase 2: Advanced security features AuditingMonitoringAdvanced encryption Phase 3: Compliance and maintenance Regular auditsCompliance checkingSecurity updates  ","version":"Next","tagName":"h2"},{"title":"Auditing and monitoring‚Äã","type":1,"pageTitle":"Security Considerations","url":"/security-basics-lab/docs/considerations#auditing-and-monitoring","content":" MongoDB AtlasOn-Premises Enable database auditing‚Äã // View audit logs using Atlas CLI atlas logs audit download \\ --projectId your-project-id \\ --output audit.json // Configure alert settings atlas alerts settings modify \\ --projectId your-project-id \\ --enabled true Importance: Database auditing provides a record of all database activities, which is crucial for identifying security breaches and ensuring compliance. Monitoring configuration‚Äã Set up database alerts atlas alerts create \\ --eventTypeName OUTSIDE_METRIC_THRESHOLD \\ --metricName CONNECTIONS \\ --threshold 5000 Importance: Setting up alerts allows you to be notified of critical events, such as high connection counts, enabling you to respond quickly to potential issues. Configure monitoring integrations atlas integrations create DATADOG \\ --apiKey your-datadog-api-key \\ --projectId your-project-id Importance: Integrating with monitoring tools like Datadog provides comprehensive insights into your database's performance and security, enabling proactive management.  ","version":"Next","tagName":"h2"},{"title":"Backup and recovery‚Äã","type":1,"pageTitle":"Security Considerations","url":"/security-basics-lab/docs/considerations#backup-and-recovery","content":" MongoDB AtlasOn-Premises Continuous backup‚Äã Configure backup policy: atlas clusters update backup \\ --projectId your-project-id \\ --clusterName Cluster0 \\ --provider AWS \\ --type continuous Importance: Continuous backups ensure that you can recover your data to any point in time, minimizing data loss in case of a failure. Point-in-time recovery‚Äã Restore to a specific point: atlas clusters restore \\ --projectId your-project-id \\ --clusterName Cluster0 \\ --typeTimestamp 2024-01-20T10:00:00Z Importance: Point-in-time recovery allows you to restore your database to a specific point in time, which is crucial for recovering from accidental data deletion or corruption.  ","version":"Next","tagName":"h2"},{"title":"On-premise security architecture‚Äã","type":1,"pageTitle":"Security Considerations","url":"/security-basics-lab/docs/considerations#on-premise-security-architecture","content":" DevelopmentProduction Development environment setup‚Äã # mongod.conf for development security: authorization: enabled net: bindIp: 127.0.0.1 port: 27017 tls: mode: preferTLS certificateKeyFile: /path/to/mongodb-dev.pem Local testing configuration‚Äã // Create development admin user use admin db.createUser({ user: &quot;devAdmin&quot;, pwd: &quot;devPassword&quot;, roles: [ { role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; }, { role: &quot;readWriteAnyDatabase&quot;, db: &quot;admin&quot; } ] })   ","version":"Next","tagName":"h2"},{"title":"Advanced security features‚Äã","type":1,"pageTitle":"Security Considerations","url":"/security-basics-lab/docs/considerations#advanced-security-features","content":" EncryptionAuditing Enterprise encryption‚Äã Configure enterprise encryption: security: enableEncryption: true encryptionCipherMode: AES256-CBC encryptionKeyFile: /path/to/master-key.txt kmip: serverName: kmip.server.com port: 5696 clientCertificateFile: /path/to/kmip.pem Encryption key rotation‚Äã // Rotate database key db.adminCommand({ rotateMasterKey: 1 }) // Check encryption status db.adminCommand({ getCipherInformation: 1 })   ","version":"Next","tagName":"h2"},{"title":"Security compliance‚Äã","type":1,"pageTitle":"Security Considerations","url":"/security-basics-lab/docs/considerations#security-compliance","content":" PCI DSSGDPR PCI DSS requirements‚Äã Install and maintain a firewall configuration # Configure iptables for PCI compliance iptables -A INPUT -p tcp --dport 27017 -j LOG iptables -A INPUT -p tcp --dport 27017 -m state --state NEW -m recent --set iptables -A INPUT -p tcp --dport 27017 -m state --state NEW -m recent --update --seconds 60 --hitcount 10 -j DROP Encrypt transmission of cardholder data # mongod.conf security: enableEncryption: true net: tls: mode: requireTLS FIPSMode: true   ","version":"Next","tagName":"h2"},{"title":"Best practices summary‚Äã","type":1,"pageTitle":"Security Considerations","url":"/security-basics-lab/docs/considerations#best-practices-summary","content":" System configuration Enable authentication and authorization Configure TLS/SSL encryption Set up IP binding restrictions Implement RBAC Monitoring and auditing Configure audit logging Set up monitoring tools Implement log rotation Enable performance monitoring Backup and recovery Implement automated backups Test recovery procedures Secure backup storage Document recovery processes Compliance and documentation Maintain security documentation Regular security audits Compliance validation Staff training  ","version":"Next","tagName":"h2"},{"title":"Next steps‚Äã","type":1,"pageTitle":"Security Considerations","url":"/security-basics-lab/docs/considerations#next-steps","content":" After implementing these advanced security measures:  Regularly test security configurations.Conduct security audits.Update documentation.Train team members on security procedures. ","version":"Next","tagName":"h2"},{"title":"üéØ Summary","type":0,"sectionRef":"#","url":"/security-basics-lab/docs/summary","content":"üéØ Summary Congratulations! Following this hands-on lab, you have successfully learned: How to configure Atlas-specific security features, such as network access controls and private endpointsHow to set up user authentication with X.509 certificates and credentialsHow to create a manager roles, assign privilages to roles and implement role inheritanceHow to use queryable encryption to write and read encrypted field data You now have everything you need to earn your Secure MongoDB Atlas: AuthN and AuthZ Skill Badge ‚Äî an official recognition of your MongoDB knowledge. Claim your badge for free and proudly display it on your LinkedIn profile under Licenses &amp; Certifications! Explore all free MongoDB Skill Badges and level up your skills today!","keywords":"","version":"Next"},{"title":"üìò Role-based Access Control (RBAC)","type":0,"sectionRef":"#","url":"/security-basics-lab/docs/rbac","content":"","keywords":"","version":"Next"},{"title":"Understanding RBAC components‚Äã","type":1,"pageTitle":"üìò Role-based Access Control (RBAC)","url":"/security-basics-lab/docs/rbac#understanding-rbac-components","content":" ","version":"Next","tagName":"h2"},{"title":"Roles‚Äã","type":1,"pageTitle":"üìò Role-based Access Control (RBAC)","url":"/security-basics-lab/docs/rbac#roles","content":" A role consists of:  Privileges (actions allowed on resources).Roles (other roles from which this role inherits privileges).  MongoDB AtlasOn-Premises Built-in roles in Atlas‚Äã Organization roles (examples) Organization OwnerOrganization MemberOrganization Read Only For all roles, see the documentation. Project roles (examples) Project OwnerProject Data Access AdminProject Data Access Read/WriteProject Read Only For more project-level roles, see the documentation. Managing roles in Atlas‚Äã ## Using Atlas CLI to create a user with specific roles atlas dbusers create \\ --username dataAdmin \\ --password &quot;securePassword&quot; \\ --role &quot;readWrite@admin&quot; \\ --projectId your-project-id ## Add additional roles atlas dbusers update dataAdmin \\ --role &quot;readAnyDatabase@admin&quot; \\ --projectId your-project-id Custom roles example‚Äã ## Create a custom role for sales data access atlas customDbRoles create &lt;role-name&gt; --inheritedRole read@salesDB --projectId {project_id} ## Assign a custom role atlas dbusers create --username readOnlyUser --password readOnlyPass --role &lt;role-name&gt; --projectId {project_id}   ","version":"Next","tagName":"h3"},{"title":"Role management best practices‚Äã","type":1,"pageTitle":"üìò Role-based Access Control (RBAC)","url":"/security-basics-lab/docs/rbac#role-management-best-practices","content":" MongoDB AtlasOn-Premises Project-level access control Use project roles for team-based accessImplement separate projects for development/productionRegular audit of project members API access Use programmatic API keys with appropriate rolesRotate API keys regularlyMonitor API key usage Example: // Create programmatic API key atlas organizations apiKeys create \\ --desc &quot;Application API Key&quot; \\ --role ORG_MEMBER   ","version":"Next","tagName":"h2"},{"title":"Practical examples‚Äã","type":1,"pageTitle":"üìò Role-based Access Control (RBAC)","url":"/security-basics-lab/docs/rbac#practical-examples","content":" MongoDB AtlasOn-Premises Application-specific roles‚Äã // Create read-only analytics role atlas customDBRoles create analyticsReader \\ --privilege '{ resource: { db: &quot;analytics&quot;, collection: &quot;&quot; }, actions: [&quot;find&quot;] }' \\ --projectId your-project-id Custom role 'analyticsReader' successfully created. // Assign role to user atlas dbusers create \\ --username analyst \\ --password &quot;securePassword&quot; \\ --role analyticsReader \\ --projectId your-project-id Database user 'analyst' successfully created.   ","version":"Next","tagName":"h2"},{"title":"Next steps‚Äã","type":1,"pageTitle":"üìò Role-based Access Control (RBAC)","url":"/security-basics-lab/docs/rbac#next-steps","content":" After understanding RBAC, let's do a challenge to test our knowledge. ","version":"Next","tagName":"h2"},{"title":"üìò Queryable Encryption","type":0,"sectionRef":"#","url":"/security-basics-lab/docs/queryable-encryption","content":"","keywords":"","version":"Next"},{"title":"Why is Queryable Encryption important in MongoDB?‚Äã","type":1,"pageTitle":"üìò Queryable Encryption","url":"/security-basics-lab/docs/queryable-encryption#why-is-queryable-encryption-important-in-mongodb","content":" MongoDB, while offering various security features, can benefit significantly from Queryable Encryption for scenarios involving highly sensitive data. By implementing it, you ensure:  Enhanced data protection: Sensitive data remains encrypted even when it is being processed on the database side, minimizing the risk of exposure in case of a security breach or unauthorized access.Compliance with regulations: Meet stringent data privacy regulations‚Äîlike GDPR and HIPAA‚Äîthat mandate strong encryption and control over sensitive information.Reduced insider threat: Even database administrators or authorized personnel with access to the database infrastructure cannot see the plaintext data without the appropriate decryption keys managed outside of the database.Maintained functionality: Unlike traditional encryption where data needs to be decrypted for querying, Queryable Encryption allows you to perform specific types of queries directly on the encrypted data, preserving application functionality.  ","version":"Next","tagName":"h2"},{"title":"Overview‚Äã","type":1,"pageTitle":"üìò Queryable Encryption","url":"/security-basics-lab/docs/queryable-encryption#overview","content":" MongoDB AtlasOn-Premises In MongoDB Atlas, Queryable Encryption is available for: M10 or larger clusters.MongoDB 7.0 or later.Enterprise or Atlas deployments. To enable Queryable Encryption: Create an encryption key in your preferred key management system (local, AWS KMS, Azure Key Vault, GCP KMS).Configure your Atlas cluster to use the KMS provider.Use the MongoDB driver with Queryable Encryption support.  ","version":"Next","tagName":"h2"},{"title":"Key concepts in Queryable Encryption‚Äã","type":1,"pageTitle":"üìò Queryable Encryption","url":"/security-basics-lab/docs/queryable-encryption#key-concepts-in-queryable-encryption","content":" Key management system (KMS): A secure system for managing encryption keys. MongoDB Queryable Encryption relies on either local keys/on-premises vaults like Hashicorp, or external KMS providers like AWS KMS, Azure Key Vault, or Google Cloud KMS to store and manage the cryptographic keys.Encryption on Field Level Basis: Encryption and decryption operations are performed on the client-side application before data is sent to or retrieved from the MongoDB server. This ensures that the server only handles encrypted data.Encryption Schema: Defines which fields in your documents need to be encrypted and specifies the type of encryption to be used for each field, influencing the types of queries that can be performed on that field.  ","version":"Next","tagName":"h2"},{"title":"Implementation‚Äã","type":1,"pageTitle":"üìò Queryable Encryption","url":"/security-basics-lab/docs/queryable-encryption#implementation","content":" ","version":"Next","tagName":"h2"},{"title":"Setting Up Queryable Encryption‚Äã","type":1,"pageTitle":"üìò Queryable Encryption","url":"/security-basics-lab/docs/queryable-encryption#setting-up-queryable-encryption","content":" Configure KMS provider In this example, see how to configure AWS KMS by providing access key ID and secret access key. It also shows how to configure a master key with its key, region, and endpoint.  const kmsProviders = { aws: { accessKeyId: process.env.AWS_ACCESS_KEY_ID, secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY } }; const masterKey = { key: process.env.MASTER_KEY, region: &quot;us-east-1&quot;, endpoint: &quot;kms.us-east-1.amazonaws.com&quot; };   Or local key: This shows how to configure a local key for testing purposes.  local_master_key = os.urandom(96) kms_providers = {&quot;local&quot;: {&quot;key&quot;: local_master_key}}   Create client encryption This step creates a client with auto encryption options.  encrypted_client = MongoClient( new_connection, auto_encryption_opts=auto_encryption_options)   Define encryption schema This step defines the encryption schema for the fields that need to be encrypted. In this example, the &quot;accountNumber&quot; field is configured for equality queries.  encrypted_fields_map = { &quot;fields&quot;: [ { &quot;path&quot;: &quot;accountNumber&quot;, &quot;bsonType&quot;: &quot;string&quot;, &quot;queries&quot;: [{&quot;queryType&quot;: &quot;equality&quot;}] # potentially 'range' } ] } ;   ","version":"Next","tagName":"h3"},{"title":"Using encrypted fields‚Äã","type":1,"pageTitle":"üìò Queryable Encryption","url":"/security-basics-lab/docs/queryable-encryption#using-encrypted-fields","content":" ","version":"Next","tagName":"h2"},{"title":"Creating & querying documents with encrypted fields‚Äã","type":1,"pageTitle":"üìò Queryable Encryption","url":"/security-basics-lab/docs/queryable-encryption#creating--querying-documents-with-encrypted-fields","content":" The following example demonstrates the complete workflow for creating and querying documents with encrypted fields:  # Step 1: Initialize the encrypted client with auto-encryption options # This client automatically handles encryption/decryption of specified fields encrypted_client = MongoClient( new_connection, auto_encryption_opts=auto_encryption_options) # Step 2: Set up the client encryption object # This object manages the encryption keys and handles the encryption operations client_encryption = ClientEncryption( kms_providers=kms_providers, key_vault_namespace=key_vault_namespace, key_vault_client=encrypted_client, codec_options=CodecOptions() ) # Step 3: Create an encrypted collection with the specified encryption schema # This sets up the collection with automatic field-level encryption client_encryption.create_encrypted_collection( encrypted_client[encrypted_database_name], encrypted_collection_name, encrypted_fields_map, kms_provider_name, {}, ) # Step 4: Prepare a document with sensitive information # Note: The 'accountNumber' field will be automatically encrypted based on the schema doc = { &quot;owner&quot;: &quot;Jon Doe&quot;, &quot;accountNumber&quot;: &quot;987-65-4320&quot;, # This field will be encrypted &quot;billing&quot;: { &quot;type&quot;: &quot;Visa&quot;, &quot;number&quot;: &quot;4111111111111111&quot;, # Consider encrypting this field too } } # Step 5: Get a reference to the encrypted collection encrypted_collection = encrypted_client[encrypted_database_name][encrypted_collection_name] # Step 6: Insert the document # The encryption happens automatically for the specified fields result = encrypted_collection.insert_one(doc) print(f&quot;Inserted document ID: {result.inserted_id}&quot;) # Step 7: Query the encrypted collection # You can query encrypted fields normally - the encryption/decryption is handled automatically find_result = encrypted_collection.find_one({ &quot;accountNumber&quot;: &quot;987-65-4320&quot; # The query value is automatically encrypted }) print(find_result) # The result is automatically decrypted when retrieved   This example demonstrates the power of Queryable Encryption‚Äîyou can work with encrypted data as if it were normal data, while the encryption and decryption happen automatically in the background based on your schema configuration.  ","version":"Next","tagName":"h3"},{"title":"Supported query types‚Äã","type":1,"pageTitle":"üìò Queryable Encryption","url":"/security-basics-lab/docs/queryable-encryption#supported-query-types","content":" Queryable Encryption supports various query types depending on the encryption algorithm:  Equality queries Exact matches on encrypted fieldsSupported with deterministic encryptionExample: {&quot;encryptedField&quot;: &quot;exactValue&quot;} Range queries Comparison operators ($gt, $gte, $lt, $lte)Available for range-queryable encrypted fieldsExample: {&quot;encryptedField&quot;: {&quot;$gt&quot;: &quot;value&quot;}}Requires RangePreview algorithm  ","version":"Next","tagName":"h2"},{"title":"Best practices‚Äã","type":1,"pageTitle":"üìò Queryable Encryption","url":"/security-basics-lab/docs/queryable-encryption#best-practices","content":" Key management Securely manage KMS credentials: Protect your KMS access keys and credentials diligently. Use best practices for secret management.Regularly rotate encryption keys.Securely store and backup keys.Use separate keys for different environments. Performance considerations Understand performance implications: Queryable Encryption involves additional resources for indexing and storage on the server side. Test and optimize your application accordingly. Tune the relevant parameters and document design for best performance.Index encrypted fields when needed.Monitor query performance on encrypted fields.Use appropriate encryption algorithms. Security guidelines Principle of least privilege: Grant only the necessary permissions to access encryption keys.Follow the principle of least privilege.Encrypt only necessary fields.Regularly audit encryption configurations.  ","version":"Next","tagName":"h2"},{"title":"Challenges and exercises‚Äã","type":1,"pageTitle":"üìò Queryable Encryption","url":"/security-basics-lab/docs/queryable-encryption#challenges-and-exercises","content":" For hands-on practice with Queryable Encryption concepts, check out our practical challenges.  ","version":"Next","tagName":"h2"},{"title":"Next steps‚Äã","type":1,"pageTitle":"üìò Queryable Encryption","url":"/security-basics-lab/docs/queryable-encryption#next-steps","content":" After implementing Queryable Encryption, you can reach the final closing phase of Additional Security Considerations and Summary. ","version":"Next","tagName":"h2"},{"title":"üëê Initial Setup and Access for Atlas CLI","type":0,"sectionRef":"#","url":"/security-basics-lab/docs/setup","content":"","keywords":"","version":"Next"},{"title":"Open the template notebook‚Äã","type":1,"pageTitle":"üëê Initial Setup and Access for Atlas CLI","url":"/security-basics-lab/docs/setup#open-the-template-notebook","content":" tip We recommend using one of the online environments below to run Jupyter Notebooks.  Google Colab\tGitHub Codespaces\tClone locally Template notebook  ","version":"Next","tagName":"h2"},{"title":"1. Install Atlas CLI on the notebook environment.‚Äã","type":1,"pageTitle":"üëê Initial Setup and Access for Atlas CLI","url":"/security-basics-lab/docs/setup#1-install-atlas-cli-on-the-notebook-environment","content":" Run the 1st cell in the notebook to install the Atlas CLI, a command line interface to manage MongoDB clusters.  note If you're running the notebook in a Codespace you'll be prompted to install two suggested extensions: a Python environment and Jupyter Notebooks support. Install them. When finsished, select the Python environment when prompted.  # Install atlas-cli !wget https://fastdl.mongodb.org/mongocli/mongodb-atlas-cli_1.46.3_linux_x86_64.deb !sudo dpkg -i mongodb-atlas-cli_1.46.3_linux_x86_64.deb # If you require sudo privilege, run the following instead: # !sudo dpkg -i mongodb-atlas-cli_1.46.3_linux_x86_64.deb   ","version":"Next","tagName":"h2"},{"title":"2. Authenticate the CLI against your Atlas organization.‚Äã","type":1,"pageTitle":"üëê Initial Setup and Access for Atlas CLI","url":"/security-basics-lab/docs/setup#2-authenticate-the-cli-against-your-atlas-organization","content":" atlas auth login typically enters interactive mode. We are piping a new line character so that it selects a default organization for you.  # Authenticate with Atlas CLI !echo -e &quot;\\n&quot; | atlas auth login --noBrowser   tip Important! This task requires you to click the connect link https://account.mongodb.com/account/connect and input the eight-digit code prompted. Once logged in, you should see a success mark on that cell. Expand to see example Run the cell and get the verification code as well as the authentication link and open it in a new tab: Proceed to login into https://account.mongodb.com/account/connect and provide the code in the opened authentication tab: Confirm the CLI access and go back to the notebook: You should see an output in the notebook cell similar to: To verify your account, copy your one-time verification code: X9G4-KP98 Paste the code in the browser when prompted to activate your Atlas CLI. Your code will expire after 10 minutes. To continue, go to https://account.mongodb.com/account/connect Successfully logged in as pavel.duchovny@mongodb.com. ...   ","version":"Next","tagName":"h2"},{"title":"2.1 Get the organization ID‚Äã","type":1,"pageTitle":"üëê Initial Setup and Access for Atlas CLI","url":"/security-basics-lab/docs/setup#21-get-the-organization-id","content":" If you are a member of more than one Atlas organization, after login in you'll see a list of your organizations and you can select the one you prefer to run the lab. But if you're using a free account you only have one organization, and the list won't appear.  You have more than one organizationYou have only one organization (free accounts most likely) Take a note of the relevant Organization ID for next steps and &quot;STOP&quot; the cell.  ","version":"Next","tagName":"h3"},{"title":"3. Create a new project called \"MySecureProj.\"‚Äã","type":1,"pageTitle":"üëê Initial Setup and Access for Atlas CLI","url":"/security-basics-lab/docs/setup#3-create-a-new-project-called-mysecureproj","content":" Replace &lt;ORGANIZATION_ID&gt; with the Organization ID from the previous step.  # Retain the quotes (&quot;&quot;) when pasting the Organization ID org_id = &quot;&lt;ORGANIZATION_ID&gt;&quot; !atlas projects create MySecureProj --orgId {org_id}   There should be an output which shows the Project ID of the project created. Use this Project ID for the next step.  ","version":"Next","tagName":"h2"},{"title":"4. Create your challenge cluster.‚Äã","type":1,"pageTitle":"üëê Initial Setup and Access for Atlas CLI","url":"/security-basics-lab/docs/setup#4-create-your-challenge-cluster","content":" Replace &lt;PROJECT_ID&gt; with the Project ID from the previous step.  This will provision an M0, free forever cluster, running in AWS in region US_EAST_1. That cluster will be associated to the project we just created.  # Retain the quotes (&quot;&quot;) when pasting the Project ID project_id = &quot;&lt;PROJECT_ID&gt;&quot; # You may select a region closer to you instead of &quot;US_EAST_1&quot; !atlas clusters create MyNewCluster --provider AWS --region US_EAST_1 --tier M0 --projectId {project_id}   ","version":"Next","tagName":"h2"},{"title":"Next steps‚Äã","type":1,"pageTitle":"üëê Initial Setup and Access for Atlas CLI","url":"/security-basics-lab/docs/setup#next-steps","content":" Progress to Network Setup for authorising access to your Atlas deployment. ","version":"Next","tagName":"h2"}],"options":{"id":"default"}}